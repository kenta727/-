<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ito Web - Final Edition</title>
    <style>
        :root {
            --primary: #4a90e2; --bg: #f8f9fa; --card-bg: #ffffff;
            --accent: #e67e22; --danger: #e74c3c; --success: #2ecc71;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg); margin: 0;
            padding: env(safe-area-inset-top) 20px env(safe-area-inset-bottom) 20px;
            display: flex; justify-content: center; color: #333;
        }
        .container { max-width: 500px; width: 100%; display: flex; flex-direction: column; min-height: 90vh; }
        h1 { font-size: 1.6rem; margin: 20px 0; text-align: center; }

        .panel { background: white; padding: 25px; border-radius: 24px; box-shadow: 0 8px 30px rgba(0,0,0,0.08); margin-bottom: 20px; }
        
        .screen { display: none; }
        .active { display: block; }

        /* 数字の表示スタイル（重要：hidden時は透明にする） */
        .secret-num { font-size: 5rem; font-weight: 900; color: var(--primary); margin: 30px 0; transition: 0.3s; }
        .number-display { font-size: 2.8rem; font-weight: 900; color: var(--primary); margin-top: 5px; transition: 0.3s; }
        
        /* 隠し状態の定義：透明度0にして完全に見えなくする */
        .hidden { opacity: 0; pointer-events: none; }
        .blur { filter: blur(30px); opacity: 0.1; }

        input[type="text"], input[type="number"] {
            width: 100%; padding: 16px; font-size: 16px; border: 2px solid #eee;
            border-radius: 12px; margin-bottom: 10px; box-sizing: border-box;
        }

        .player-list { display: grid; gap: 12px; }
        .player-card {
            background: var(--card-bg); padding: 18px; border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.04); border: 1px solid #f0f0f0; position: relative;
            min-height: 120px; display: flex; flex-direction: column; align-items: center;
        }
        .rank-badge { position: absolute; top: 12px; left: 12px; background: var(--success); color: white; padding: 3px 10px; border-radius: 12px; font-size: 0.7rem; display: none; }
        .player-name { font-weight: bold; font-size: 1.1rem; margin-bottom: 8px; width: 100%; text-align: left; }

        .btn {
            border: none; padding: 18px; border-radius: 16px; font-size: 1rem; font-weight: bold;
            cursor: pointer; transition: 0.2s; color: white; display: block; width: 100%; margin-top: 10px;
        }
        .btn-main { background: var(--primary); }
        .btn-accent { background: var(--accent); }
        .btn-reveal { background: var(--danger); }
        .btn-success { background: var(--success); }
        .btn-sub { background: #adb5bd; }
        .btn:active { opacity: 0.7; }
    </style>
</head>
<body>

<div class="container">
    <h1>ito Web Client</h1>

    <div id="setup-screen" class="screen active panel">
        <label style="font-weight: bold;">プレイヤー人数:</label>
        <input type="number" id="player-count" value="4" min="1" max="10" onchange="generateNameInputs()">
        <div id="name-inputs"></div>
        <button class="btn btn-main" onclick="startGame()">ゲームを開始</button>
    </div>

    <div id="reveal-screen" class="screen panel" style="text-align: center;">
        <h2 id="current-player-prompt">次は 〇〇 さん</h2>
        <p>他の人に見えないようにしてボタンを押してね</p>
        <div id="secret-display" class="secret-num blur">?</div>
        <button id="show-btn" class="btn btn-accent" onclick="toggleSecret(true)">自分の数字を見る</button>
        <button id="hide-btn" class="btn btn-main" style="display:none;" onclick="nextStep()">確認した（隠す）</button>
    </div>

    <div id="game-screen" class="screen">
        <div class="panel" style="border-left: 6px solid var(--accent);">
            <div id="theme" style="font-weight: bold; font-size: 1.2rem; color: var(--accent);">お題：なし</div>
            <p style="font-size: 0.8rem; color: #888; margin-top: 5px;">カードをタップすると自分の数字を確認できます</p>
        </div>
        <div id="players" class="player-list"></div>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn btn-reveal" style="flex:1" onclick="revealAll()">全員公開</button>
            <button class="btn btn-success" style="flex:1" onclick="sortCards()">順番公開</button>
        </div>
        <button class="btn btn-sub" onclick="location.reload()">タイトルに戻る</button>
    </div>
</div>

<script>
    const themes = ["食べ物の人気", "怖いもの", "モテる趣味", "欲しい超能力", "ゾンビへの武器", "IT用語のかっこよさ", "SEの忙しさ", "運の良さ", "コミュ力", "最強の必殺技", "転生したい世界", "睡眠の質", "無人島に持っていくもの", "嫌いな家事", "プログラミングの難易度", "便利な家電"];

    let gameState = { names: [], numbers: [], currentIndex: 0 };

    function generateNameInputs() {
        const count = document.getElementById('player-count').value;
        const container = document.getElementById('name-inputs');
        container.innerHTML = '';
        for (let i = 1; i <= count; i++) {
            container.innerHTML += `<input type="text" class="player-name-input" placeholder="プレイヤー ${i}" value="プレイヤー ${i}">`;
        }
    }
    window.onload = generateNameInputs;

    function startGame() {
        gameState.names = Array.from(document.querySelectorAll('.player-name-input')).map(input => input.value || "名無し");
        gameState.numbers = Array.from({length: 100}, (_, i) => i + 1).sort(() => Math.random() - 0.5);
        gameState.currentIndex = 0;
        document.getElementById('theme').innerText = "お題：" + themes[Math.floor(Math.random() * themes.length)];
        showScreen('reveal-screen');
        updateRevealScreen();
    }

    function updateRevealScreen() {
        document.getElementById('current-player-prompt').innerText = `次は ${gameState.names[gameState.currentIndex]} さん`;
        toggleSecret(false);
    }

    function toggleSecret(show) {
        const display = document.getElementById('secret-display');
        const showBtn = document.getElementById('show-btn');
        const hideBtn = document.getElementById('hide-btn');
        if (show) {
            display.innerText = gameState.numbers[gameState.currentIndex];
            display.classList.remove('blur');
            showBtn.style.display = 'none';
            hideBtn.style.display = 'block';
        } else {
            display.innerText = '?';
            display.classList.add('blur');
            showBtn.style.display = 'block';
            hideBtn.style.display = 'none';
        }
    }

    function nextStep() {
        gameState.currentIndex++;
        if (gameState.currentIndex < gameState.names.length) {
            updateRevealScreen();
        } else {
            initGameBoard();
        }
    }

    // ★重要：ゲーム画面生成時はすべて hidden クラスを適用して隠す
    function initGameBoard() {
        const playerList = document.getElementById('players');
        playerList.innerHTML = '';
        gameState.names.forEach((name, i) => {
            const card = document.createElement('div');
            card.className = 'player-card';
            card.setAttribute('data-number', gameState.numbers[i]);
            card.innerHTML = `
                <div class="rank-badge"></div>
                <div class="player-name">${name}</div>
                <input type="text" class="memo-input" style="width:90%; padding:10px; border:1px dashed #bbb; border-radius:10px; font-size:0.9rem; text-align:center; margin-bottom:10px;" placeholder="例えをメモ..." onclick="event.stopPropagation()">
                <div class="number-display hidden">${gameState.numbers[i]}</div>
            `;
            // タップでその人の数字だけトグル（表示/非表示）
            card.onclick = function() {
                this.querySelector('.number-display').classList.toggle('hidden');
            };
            playerList.appendChild(card);
        });
        showScreen('game-screen');
    }

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0,0);
    }

    function revealAll() {
        document.querySelectorAll('.number-display').forEach(d => d.classList.remove('hidden'));
    }

    function sortCards() {
        const list = document.getElementById('players');
        const cards = Array.from(list.getElementsByClassName('player-card'));
        cards.sort((a, b) => parseInt(a.getAttribute('data-number')) - parseInt(b.getAttribute('data-number')));
        cards.forEach((card, i) => {
            const badge = card.querySelector('.rank-badge');
            badge.innerText = `${i + 1}番目`;
            badge.style.display = 'block';
            list.appendChild(card);
        });
        revealAll(); // ソート時は答え合わせなので全員公開
    }
</script>

</body>
</html>
