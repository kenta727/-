
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Number Order Game</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        :root {
            --primary: #4a90e2; --bg: #f8f9fa; --card-bg: #ffffff;
            --accent: #e67e22; --danger: #e74c3c; --success: #2ecc71;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg); margin: 0;
            padding: env(safe-area-inset-top) 20px env(safe-area-inset-bottom) 20px;
            display: flex; justify-content: center; color: #333;
        }
        .container { max-width: 500px; width: 100%; display: flex; flex-direction: column; min-height: 90vh; }
        h1 { font-size: 1.6rem; margin: 20px 0; text-align: center; }

        .panel { background: white; padding: 25px; border-radius: 24px; box-shadow: 0 8px 30px rgba(0,0,0,0.08); margin-bottom: 20px; }
        
        .screen { display: none; }
        .active { display: block; }

        .secret-num { font-size: 5rem; font-weight: 900; color: var(--primary); margin: 30px 0; transition: 0.3s; }
        .number-display { font-size: 2.8rem; font-weight: 900; color: var(--primary); margin-top: 5px; transition: 0.2s; }
        
        .hidden { opacity: 0 !important; pointer-events: none; }
        .blur { filter: blur(30px); opacity: 0.1; }

        input[type="text"], input[type="number"] {
            width: 100%; padding: 16px; font-size: 16px; border: 2px solid #eee;
            border-radius: 12px; margin-bottom: 10px; box-sizing: border-box;
        }

        .player-list { display: grid; gap: 12px; }
        .player-card {
            background: var(--card-bg); padding: 15px; border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.04); border: 1px solid #f0f0f0; 
            position: relative; display: flex; align-items: center; gap: 12px;
            cursor: grab; transition: transform 0.2s;
        }
        .player-card:active { cursor: grabbing; }
        
        .sortable-ghost { opacity: 0.4; transform: scale(0.95); background: #e9ecef; }

        .drag-handle { color: #ccc; font-size: 1.4rem; user-select: none; width: 20px; }

        /* 修正箇所: card-main 内を中央寄せに */
        .card-main { flex: 1; display: flex; flex-direction: column; align-items: center; margin-right: 20px; }
        .rank-badge { position: absolute; top: 10px; left: 10px; background: var(--success); color: white; padding: 3px 10px; border-radius: 12px; font-size: 0.7rem; display: none; z-index: 10; }
        
        /* 修正箇所: プレイヤー名を中央寄せに */
        .player-name { font-weight: bold; font-size: 1.1rem; margin-bottom: 8px; width: 100%; text-align: center; }

        .theme-box {
            background: #fff5eb; border-left: 6px solid var(--accent); padding: 15px;
            border-radius: 12px; margin-bottom: 20px; text-align: left;
        }
        .theme-label { font-size: 0.8rem; color: var(--accent); font-weight: bold; margin-bottom: 4px; }
        .theme-text { font-weight: bold; font-size: 1.2rem; color: #333; }

        .btn {
            border: none; padding: 18px; border-radius: 16px; font-size: 1rem; font-weight: bold;
            cursor: pointer; transition: 0.2s; color: white; display: block; width: 100%; margin-top: 10px;
        }
        .btn-main { background: var(--primary); }
        .btn-accent { background: var(--accent); }
        .btn-reveal { background: var(--danger); }
        .btn-success { background: var(--success); }
        .btn-sub { background: #adb5bd; }
        .btn:active { opacity: 0.7; }
    </style>
</head>
<body>

<div class="container">
    <h1>Number Order Game</h1>

    <div id="setup-screen" class="screen active panel">
        <label style="font-weight: bold;">プレイヤー人数:</label>
        <input type="number" id="player-count" value="4" min="1" max="10" onchange="generateNameInputs()">
        <div id="name-inputs"></div>
        <button class="btn btn-main" onclick="startGame()">ゲームを開始</button>
    </div>

    <div id="reveal-screen" class="screen panel" style="text-align: center;">
        <div class="theme-box">
            <div class="theme-label">今回のお題</div>
            <div id="theme-display-reveal" class="theme-text">---</div>
        </div>
        <h2 id="current-player-prompt">次は 〇〇 さん</h2>
        <p>他の人に見えないようにしてボタンを押してね</p>
        <div id="secret-display" class="secret-num blur">?</div>
        <button id="show-btn" class="btn btn-accent" onclick="toggleSecret(true)">自分の数字を見る</button>
        <button id="hide-btn" class="btn btn-main" style="display:none;" onclick="nextStep()">確認した（隠す）</button>
    </div>

    <div id="game-screen" class="screen">
        <div class="panel" style="border-left: 6px solid var(--accent);">
            <div id="theme" style="font-weight: bold; font-size: 1.2rem; color: var(--accent);">お題：なし</div>
            <p style="font-size: 0.75rem; color: #888; margin-top: 5px;">カードをドラッグして小さい順に並び替えよう！</p>
        </div>
        <div id="players" class="player-list"></div>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn btn-reveal" style="flex:1" onclick="revealAll()">全員公開</button>
            <button class="btn btn-success" style="flex:1" onclick="sortCards()">正解順に並び替え</button>
        </div>
        <button class="btn btn-sub" onclick="location.reload()">タイトルに戻る</button>
    </div>
</div>

<script>
    const themes = ["コンビニの商品の人気（1:人気ない-100:人気ある）",
        "100円ショップの商品の人気（1:人気ない-100:人気ある）",
        "飲食店の人気（1:人気ない-100:人気ある）",
        "駅の人気（1:人気ない-100:人気ある）",
        "中華料理の人気（1:人気ない-100:人気ある）",
        "学校給食の人気（1:人気ない-100:人気ある）",
        "有名人の人気（1:人気ない-100:人気ある）",
        "子供に人気なもの（1:人気ない-100:人気ある）",
        "アニメ・漫画のキャラの人気（1:人気ない-100:人気ある）",
        "ゲームキャラの人気（モンスター含む）（1:人気ない-100:人気ある）",
        "キャラクターの人気（ゆるキャラ含む）（1:人気ない-100:人気ある）",
        "プレゼント・お土産の人気（1:人気ない-100:人気ある）",
        "建物の人気（1:人気ない-100:人気ある）",
        "住みたい国や場所の人気（1:人気ない-100:人気ある）",
        "アプリ・ウェブサービスの人気（1:人気ない-100:人気ある）",
        "乗り物の人気（1:人気ない-100:人気ある）",
        "俳優の人気（1:人気ない-100:人気ある）",
        "悪役の人気（1:人気ない-100:人気ある）",
        "食べ物の人気（1:人気ない-100:人気ある）",
        "飲み物の人気（1:人気ない-100:人気ある）",
        "生き物の人気（1:人気ない-100:人気ある）",
        "おもちゃの人気（1:人気ない-100:人気ある）",
        "電化製品の人気（1:人気ない-100:人気ある）",
        "映画の人気（1:人気ない-100:人気ある）",
        "ミュージシャンの人気（1:人気ない-100:人気ある）",
        "お菓子・スイーツ・アイスの人気（1:人気ない-100:人気ある）",
        "ペットの人気（1:人気ない-100:人気ある）",
        "職業の人気（1:人気ない-100:人気ある）",
        "おにぎりの具の人気（1:人気ない-100:人気ある）",
        "パンの種類の人気（1:人気ない-100:人気ある）",
        "趣味の人気（1:人気ない-100:人気ある）",
        "メーカー（ブランド）の人気（1:人気ない-100:人気ある）",
        "アニメ・漫画の人気（1:人気ない-100:人気ある）",
        "ゲームの人気（1:人気ない-100:人気ある）",
        "和食料理の人気（1:人気ない-100:人気ある）",
        "洋食料理の人気（1:人気ない-100:人気ある）",
        "歴史上の人物の人気（1:人気ない-100:人気ある）",
        "声優の人気（1:人気ない-100:人気ある）",
        "童話の人気（1:人気ない-100:人気ある）",
        "歌・曲の人気（1:人気ない-100:人気ある）",
        "映画の登場人物の人気（1:人気ない-100:人気ある）",
        "アスリートの人気（1:人気ない-100:人気ある）",
        "スポーツの人気（1:人気ない-100:人気ある）",
        "テレビ番組の人気（1:人気ない-100:人気ある）",
        "恋人にしたい職業の人気（1:人気ない-100:人気ある）",
        "デートスポットの人気（1:人気ない-100:人気ある）",
        "ハネムーンで行きたい場所の人気（1:人気ない-100:人気ある）",
        "酒のつまみ・居酒屋メニューの人気（1:人気ない-100:人気ある）",
        "化粧品の人気（1:人気ない-100:人気ある）",
        "ボードゲームの人気（1:人気ない-100:人気ある）",
        "資格・免許の人気（1:人気ない-100:人気ある）",
        "旅行したい国や場所の人気（1:人気ない-100:人気ある）",
        "旅行先に持っていきたいもの（1:いらない-100:持っていきたい）",
        "ゾンビと戦うときに持っていきたいもの（1:いらない-100:持っていたい）",
        "無人島に持っていきたいもの（1:いらない-100:持っていきたい）",
        "一人暮らしに必要なもの（1:いらない-100:必須）",
        "美しいもの（1:美しくない-100:美しい）",
        "こわいもの（1:こわくない-100:こわい）",
        "楽しいこと（1:楽しくない-100:楽しい）",
        "嬉しいこと（1:嬉しくない-100:嬉しい）",
        "カバンに入っていたら嬉しいもの（1:嬉しくない-100:嬉しい）",
        "言われて嬉しい言葉（1:どうでもいい-100:嬉しい）",
        "なりたい生き物（1:なりたくない-100:なりたい）",
        "なりたい歴史上の人物（1:なりたくない-100:なりたい）",
        "なりたい有名人（1:なりたくない-100:なりたい）",
        "なりたいキャラ（アニメ・漫画・ゲーム）（1:なりたくない-100:なりたい）",
        "生き物の大きさ（1:小さい-100:大きい）",
        "学校にあるものの大きさ（1:小さい-100:大きい）",
        "歴史上の人物の強さ（1:弱い-100:強い）",
        "映画の登場人物の強さ（1:弱い-100:強い）",
        "生き物の強さ（1:弱い-100:強い）",
        "アニメ・漫画のキャラの強さ（1:弱い-100:強い）",
        "ゲームキャラの強さ（モンスター含む）（1:弱い-100:強い）",
        "強そうな言葉（漢字、熟語など）（1:弱そう-100:強そう）",
        "強そうな効果音（創作OK）（1:弱そう-100:強そう）",
        "有名人の年収・資産（1:貧乏-100:金持ち）",
        "重そうなもの（1:軽い-100:重い）",
        "ボードゲームの（物理的な）重さ（1:軽い-100:重い）",
        "食べ物のカロリー（1:低カロリー-100:高カロリー）",
        "モテる条件・特技（1:モテない-100:モテる）",
        "やわらかそうなもの（1:かたい-100:やわらかい）",
        "カッコいいもの（1:カッコ悪い-100:カッコいい）",
        "カッコいいセリフ（1:カッコ悪い-100:カッコいい）",
        "カッコいい苗字・名前（1:平凡-100:カッコいい）",
        "かわいいもの（1:かわいくない-100:かわいい）",
        "小学生が好きな言葉（1:好きじゃない-100:好き）",
        "中高生が好きな言葉（1:好きじゃない-100:好き）",
        "人生で大切なもの・こと（1:どうでもいい-100:大切）",
        "雪山で遭難したときにもっていたいもの（1:いらない-100:持っていたい）",
        "地球観光に来た宇宙人にあげたいお土産（1:あげたくない-100:あげたい）",
        "テンションが上がるもの・こと（1:上がらない-100:上がる）",
        "時代遅れの言葉（1:そうでもない-100:時代遅れ）",
        "オタクが喜ぶセリフ・設定（1:喜ばない-100:喜ぶ）",
        "グッとくる仕草・行動（1:グッとこない-100:グッとくる）",
        "結婚したい有名人（1:結婚したくない-100:結婚したい）",
        "結婚したいキャラ（アニメ・漫画・ゲーム）（1:結婚したくない-100:結婚したい）",
        "親になってほしいキャラ（アニメ・漫画・ゲーム）（1:なってほしくない-100:なってほしい）",
        "ほしい特殊能力・武器（必殺技・道具）（1:いらない-100:ほしい）",
        "便利なもの（1:不便-100:便利）",
        "されたいプロポーズ（セリフ・シチュエーション）（1:されたくない-100:されたい）",
        "旅先ですることの人気（1:人気ない-100:人気ある）",
        "白米に合いそうなもの（1:合わない-100:合う）",
        "中学生になって考えよう カッコいいもの・こと（1:カッコわるい-100:カッコいい）",
        "鳥肌が立つこと（1:少し立つ-100:超立つ）",
        "1000円くらいまででできる楽しいこと（1:そこそこ-100:楽しい）",
        "桃太郎になって考えよう 頼りになる家来（1:頼りにならない-100:頼りになる）",
        "動物園にいる動物の人気（1:人気ない-100:人気ある）",
        "男女がそれぞれ好きそうなもの（1:男が好きなもの-100:女が好きなもの）",
        "祖父母になって考えよう 孫に言われたら嬉しい言葉（1:嬉しくない-100:嬉しい）",
        "ふだん聞く言葉の頻度（1:あまり聞かない-100:よく聞く）",
        "破壊力のある言葉（パワーワード）（1:破壊力ない-100:破壊力ある）",
        "冷蔵庫になって考えよう 入れてほしいもの（1:入れてほしくない-100:入れてほしい）",
        "行事の人気（1:人気ない-100:人気ある）",
        "宝箱をあけて入ってたら嬉しいもの（1:嬉しくない-100:嬉しい）",
        "幼稚園児になって考えよう テンションが上がるとき（1:上がらない-100:上がる）",
        "上に乗ってみたい動物（1:乗りたくない-100:乗りたい）",
        "商店街のくじの景品でランクが高いもの（1:低い-100:高い）",
        "SNSを活用するにあたって大切なもの・こと（1:むしろダメ-100:大切）",
        "夏に行きたい場所や国の人気（1:人気ない-100:人気ある）",
        "「一生これしか食べられない」なら選びたい食べもの（1:選びたくない-100:選びたい）",
        "猫になって考えよう 心地のいい場所（1:心地わるい-100:心地いい）",
        "いい匂いのもの（1:わるい-100:いい）",
        "強そうな5文字（1:弱そう-100:強そう）",
        "芸人になって考えよう ヤバい罰ゲーム（1:ヤバくない-100:ヤバい）",
        "コンビニで買える食べ物の人気（1:人気ない-100:人気ある）",
        "公園の石をどかしたとき、あったらビックリするもの（1:少しビックリ-100:超ビックリ）",
        "小学生になって考えよう 嬉しいこと（1:嬉しくない-100:嬉しい）",
        "明るいもの（1:明るくない-100:明るい）",
        "言われたら嬉しいプロポーズの言葉（1:嬉しくない-100:嬉しい）",
        "探検家になって考えよう ワクワクする場所（1:ワクワクしない-100:ワクワクする）",
        "寿司ネタの人気（1:人気ない-100:人気ある）",
        "動物の特徴でほしいもの（1:ほしくない-100:ほしい）",
        "お嬢様になって考えよう 優秀な執事（1:ポンコツ-100:優秀）",
        "人からごちそうされたい食べ物（1:嬉しくない-100:嬉しい）",
        "桃太郎の場面（お話のどのあたりか）（1:むかしむかし-100:めでたしめでたし）",
        "能力者になって考えよう ハデに使えそうな脳力（1:地味-100:ハデ）",
        "海の生き物の人気（1:人気ない-100:人気ある）",
        "冷蔵庫の中にあったらテンションが上がるもの（1:上がらない-100:上がる）",
        "高校生になって考えよう 授業中、起きたら大変なこと（1:大変じゃない-100:大変）",
        "写真を撮りたくなるもの（1:そうでもない-100:撮りたくなる）",
        "どうしてもこれだけは許せないということ（1:許せなくはない-100:許せない）",
        "幸せを感じること（1:感じない-100:感じる）",
        "新婚旅行先の人気（1:行きたくない-100:行きたい）",
        "学校の先生に怒られそうなこと（1:怒られない-100:怒られる）",
        "犬になって考えよう 嬉しいこと（1:嬉しくない-100:嬉しい）",
        "よく行く場所（1:あまり行かない-100:よく行く）",
        "思わず見てしまうメールのタイトル（1:見ない-100:見てしまう）",
        "ボディビルダーになって考えよう 言われたいかけ声（1:言われたくない-100:言われたい）",
        "生まれ変わったらなりたい動物（1:なりたくない-100:なりたい）",
        "大人っぽい言動（1:子供っぽい-100:大人っぽい）",
        "動画配信者にとって必要な能力・資質（1:あっちゃダメ-100:必要）",
        "家族にしてもらったら嬉しいこと（1:嬉しくない-100:嬉しい）",
        "ショックを受けた好きな人のクセ（1:少しショック-100:超ショック）",
        "侍になって考えよう 尽くしたいタイプの人（1:尽くしたくない-100:尽くしたい）",
        "食べ物のやわらかさ（1:かたい-100:やわらかい）",
        "突然の一日オフ。最高の過ごし方は？（1:最悪-100:最高）",
        "先生になって考えよう 卒業式に言われて嬉しい言葉（1:嬉しくない-100:嬉しい）",
        "幼いころにほしかったもの（1:そうでもない-100:ほしかった）",
        "宇宙にいるときにやってみたい行動（1:やりたくない-100:やってみたい）",
        "お笑い芸人にとって必要な能力・資質（1:あっちゃダメ-100:必要）",
        "寝起きにしたいこと（1:したくない-100:したい）",
        "変顔の度合い（実際にやる）（1:ふつう顔-100:変顔）",
        "修学旅行生になって考えよう 行きたい旅行先（1:行きたくない-100:行きたい）",
        "部屋の中にある大切なもの（1:大切ではない-100:大切）",
        "痛い思い出（物理・精神どちらでも）（1:痛くない-100:痛い）",
        "生きる上で大切なもの・こと（1:むしろダメ-100:大切）",
        "食べ物の辛さ（1:辛くない-100:辛い）",
        "カッコいいと思うエピソード（1:カッコわるい-100:カッコいい）",
        "就活中の大学生になって考えよう 働きたい職場（1:働きたくない-100:働きたい）",
        "聞こえてきたら嬉しい音（1:嬉しくない-100:嬉しい）",
        "厳しく無口な父に言われたら嬉しい言葉（1:嬉しくない-100:嬉しい）",
        "アイドル業にとって必要な能力・資質（1:あっちゃダメ-100:必要）",
        "黒いもの（1:黒くない-100:黒い）",
        "卒業式で流したら感動する音楽や効果音（1:ぶち壊し-100:感動する）",
        "魔法使いになって考えよう 使ってみたい魔法（1:使いたくない-100:使ってみたい）",
        "日常に起こるいいこと（1:よくない-100:いい）",
        "片思い中の好きな人に言われたら嬉しい言葉（1:嬉しくない-100:嬉しい）",
        "仕事をする上で必要な能力・資質（1:あっちゃダメ-100:必要）",
        "眠くなるもの（1:目が覚める-100:眠くなる）",
        "見た目が子供に戻ったならしたいこと（1:したくない-100:したい）",
        "馬主になって考えよう 速そうな馬の名前（1:速くなさそう-100:速そう）",
        "投げたいもの（1:投げたくない-100:投げたい）",
        "勇気ある行動（1:勇気ない-100:勇気ある）",
        "芸能事務所の社長になって考えよう 所属芸能人が起こしたら大変な事件（1:大変じゃない-100:大変）",
        "包まれたいもの（1:包まれたくない-100:包まれたい）",
        "砂漠で遭難したときにほしいもの（1:いらない-100:ほしい）",
        "超能力になって考えよう 友人の脳内を読んだらショックだった考え（1:少しショック-100:超ショック）",
        "ずっと見ていられるもの（1:見ていられない-100:見ていられる）",
        "死ぬまでにしたいこと（1:しなくてもいい-100:したい）",
        "ヒーローになって演じよう カッコいいポーズ（実際にやる）（1:カッコわるい-100:カッコいい）",
        "なつかしさを感じるもの・こと（1:感じない-100:感じる）",
        "テストでその点を取ったときの反応（1:1点-100:100点）",
        "母になって考えよう 子供が寝言で言っていたら嬉しいこと（1:嬉しくない-100:嬉しい）",
        "便利なスマホアプリ（1:不要-100:便利）",
        "叫ぶと必殺技っぽい言葉（創作OK）（1:ぽくない-100:ぽい）",
        "芸能人になって考えよう 「これドッキリじゃね？」と疑うできごと（1:考えすぎ-100:ドッキリっぽい）",
        "足の速い動物（1:遅い-100:速い）",
        "これは恋か愛か（1:恋-100:愛）",
        "人間関係で必要な能力・資質（1:あっちゃダメ-100:必要）",
        "おみやげにもらったら嬉しいもの（1:嬉しくない-100:嬉しい）",
        "奇跡の体験（1:少し奇跡-100:超奇跡）",
        "タイムトラベラーになって考えよう 過去から持って帰りたいもの（1:いらない-100:持って帰りたい）",
        "朝ごはんに食べたいもの（1:食べたくない-100:食べたい）",
        "お尻から出てきたらビックリするもの（1:少しビックリ-100:超ビックリ）",
        "科学者になって考えよう 発明したい薬（1:したくない-100:したい）",
        "踏んだら痛そうなもの（1:痛くない-100:痛い）",
        "SNSでめちゃくちゃいいねされそうな投稿（1:いいねされなさそう-100:いいねされそう）",
        "人物やキャラクターのイメージ（1:クール-100:パッション）",
        "疲れたときにしたいこと（1:したくない-100:したい）",
        "あったらおいしそうなアイスクリームの味（1:おいしくなさそう-100:おいしそう）",
        "赤ちゃんになって考えよう 最高の瞬間（1:最悪-100:最高）",
        "家にある便利なもの（1:便利じゃない-100:便利）",
        "5歳児が言ったらビックリする言葉（1:少しビックリ-100:超ビックリ）",
        "魔王になって考えよう こんな勇者はイヤだ（1:余裕-100:イヤだ）",
        "大学生が反応する言葉（1:反応しない-100:反応する）",
        "機嫌がいいときにしそうな行動（1:しなさそう-100:しそう）",
        "リーダーにとって必要な能力・資質（1:あっちゃダメ-100:必要）",
        "友達になりたい人の特徴（1:なりたくない-100:なりたい）",
        "人生の中で、やる回数が多いこと（1:少ない-100:多い）",
        "愛されていると思うこと（1:愛されていない-100:愛されている）" ];

    let gameState = { names: [], numbers: [], currentIndex: 0, currentTheme: "" };

    function generateNameInputs() {
        const count = document.getElementById('player-count').value;
        const container = document.getElementById('name-inputs');
        container.innerHTML = '';
        for (let i = 1; i <= count; i++) {
            container.innerHTML += `<input type="text" class="player-name-input" placeholder="プレイヤー ${i}" value="プレイヤー ${i}">`;
        }
    }
    window.onload = generateNameInputs;

    function startGame() {
        gameState.names = Array.from(document.querySelectorAll('.player-name-input')).map(input => input.value || "名無し");
        gameState.numbers = Array.from({length: 100}, (_, i) => i + 1).sort(() => Math.random() - 0.5);
        gameState.currentIndex = 0;
        gameState.currentTheme = themes[Math.floor(Math.random() * themes.length)];
        document.getElementById('theme-display-reveal').innerText = gameState.currentTheme;
        document.getElementById('theme').innerText = "お題：" + gameState.currentTheme;
        showScreen('reveal-screen');
        updateRevealScreen();
    }

    function updateRevealScreen() {
        document.getElementById('current-player-prompt').innerText = `次は ${gameState.names[gameState.currentIndex]} さん`;
        toggleSecret(false);
    }

    function toggleSecret(show) {
        const display = document.getElementById('secret-display');
        const showBtn = document.getElementById('show-btn');
        const hideBtn = document.getElementById('hide-btn');
        if (show) {
            display.innerText = gameState.numbers[gameState.currentIndex];
            display.classList.remove('blur');
            showBtn.style.display = 'none';
            hideBtn.style.display = 'block';
        } else {
            display.innerText = '?';
            display.classList.add('blur');
            showBtn.style.display = 'block';
            hideBtn.style.display = 'none';
        }
    }

    function nextStep() {
        gameState.currentIndex++;
        if (gameState.currentIndex < gameState.names.length) {
            updateRevealScreen();
        } else {
            initGameBoard();
        }
    }

    function initGameBoard() {
        const playerList = document.getElementById('players');
        playerList.innerHTML = '';
        gameState.names.forEach((name, i) => {
            const card = document.createElement('div');
            card.className = 'player-card';
            card.setAttribute('data-number', gameState.numbers[i]);
            card.innerHTML = `
                <div class="rank-badge"></div>
                <div class="drag-handle">⋮⋮</div>
                <div class="card-main">
                    <div class="player-name">${name}</div>
                    <input type="text" class="memo-input" style="width:100%; padding:10px; border:1px dashed #bbb; border-radius:10px; font-size:0.9rem; text-align:center; box-sizing:border-box;" placeholder="例えをメモ...">
                    <div class="number-display hidden">${gameState.numbers[i]}</div>
                </div>
            `;
            playerList.appendChild(card);
        });

        // Sortableの初期化
        new Sortable(playerList, {
            animation: 150,
            ghostClass: 'sortable-ghost',
            handle: '.player-card',
            filter: '.memo-input',
            preventOnFilter: false
        });

        showScreen('game-screen');
    }

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0,0);
    }

    function revealAll() {
        document.querySelectorAll('.number-display').forEach(d => d.classList.remove('hidden'));
    }

    function sortCards() {
        const list = document.getElementById('players');
        const cards = Array.from(list.getElementsByClassName('player-card'));
        cards.sort((a, b) => parseInt(a.getAttribute('data-number')) - parseInt(b.getAttribute('data-number')));
        cards.forEach((card, i) => {
            const badge = card.querySelector('.rank-badge');
            badge.innerText = `${i + 1}番目`;
            badge.style.display = 'block';
            list.appendChild(card);
        });
        revealAll();
    }
</script>

</body>
</html>
